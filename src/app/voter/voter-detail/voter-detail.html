<!-- Modal Overlay -->
<div class="modal-backdrop"></div>

<!-- Voter Details Modal -->
<div class="modal-box container p-4 rounded shadow bg-white border">
  <button class="btn-close float-end" (click)="closePopup()"></button>
  <h3 class="mb-3">Voter Details</h3>

  <!-- Show Spinner if loading -->
  @if (loading) {
    <div class="d-flex justify-content-center my-5">
      <div class="spinner-border text-primary" role="status"></div>
    </div>
  } 
  @else if (voter && !editMode) {
    <!-- View Mode -->
    <div>
      <p><strong>Name:</strong> {{ voter.name }}</p>
      <p><strong>Email:</strong> {{ voter.email }}</p>
      <p><strong>Age:</strong> {{ voter.age }}</p>

      @if (isModerator) {
        <p>
          <strong>Status:</strong>
          <span [ngClass]="voter.isDeleted ? 'text-danger' : 'text-success'">
            {{ voter.isDeleted ? 'üóëÔ∏è Deleted' : '‚úÖ Active' }}
          </span>
        </p>
      }

      <!-- Action Buttons -->
      <div class="mt-3 d-flex gap-2">
        @if (isModerator || isVoter) {
          <button class="btn btn-warning" (click)="editMode = true">Edit</button>
        }
        @if (isModerator && !voter.isDeleted) {
          <button class="btn btn-danger" (click)="deleteAccount()">Disable</button>
        }
        @if (isModerator && voter.isDeleted) {
          <button class="btn btn-success" (click)="reAddVoter()">Re-Add Voter</button>
        }
      </div>
    </div>
  } 
  @else if (editMode && voter) {
    <!-- Edit Mode -->
    <app-voter-edit-form
      [voter]="voter"
      [isVoter]="isVoter"
      [isModerator]="isModerator"
      (update)="submitEdit($event)"
      (updateWithPassword)="submitEditWithPassword($event)"
      (cancel)="editMode = false">
    </app-voter-edit-form>
  } 
  @else {
    <!-- No Voter -->
    <div class="alert alert-warning text-center">No voter found.</div>
  }

  <!-- Button to Show Previous Polls -->
  <button class="btn btn-success mt-3" (click)="prevPollsMode = true">
    View Previously Voted Polls
  </button>
</div>

<!-- Modal for Previously Voted Polls -->
@if (prevPollsMode) {
  <div class="modal-box-lg bg-white p-4 rounded shadow">
    <button class="btn-close float-end" (click)="prevPollsMode = false"></button>
    <h4 class="mb-3">Previously Voted Polls</h4>
    <app-polls-list [VoterId]="voterId" [ForVoting]="false"></app-polls-list>
  </div>
}
